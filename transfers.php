<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="TemplateMo">
    <link href="https://fonts.googleapis.com/css?family=Poppins:100,200,300,400,500,600,700,800,900&display=swap" rel="stylesheet">

    <title>Transfers</title>

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Additional CSS Files -->
    <link rel="stylesheet" href="assets/css/fontawesome.css">
    <link rel="stylesheet" href="assets/css/templatemo-finance-business.css">
    <link rel="stylesheet" href="assets/css/owl.css">

  </head>
  <body>

        <!-- Header -->
        <div class="sub-header">
          <div class="container">
            <div class="row">
              <div class="col-md-8 col-xs-12">
                <ul class="left-info">
                  <li><a href="#"><i class="fa fa-clock-o"></i>Mon-Fri 09:00-17:00</a></li>
                  <li><a href="#"><i class="fa fa-phone"></i>090-080-0760</a></li>
                </ul>
              </div>
              <div class="col-md-4">
                <ul class="right-icons">
                  <li><a href="#"><i class="fa fa-facebook"></i></a></li>
                  <li><a href="#"><i class="fa fa-twitter"></i></a></li>
                  <li><a href="#"><i class="fa fa-linkedin"></i></a></li>
                  <li><a href="#"><i class="fa fa-behance"></i></a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        <header class="" background="#a4c639">
          <nav class="navbar navbar-expand-lg">
            <div class="container">
              <a class="navbar-brand" href="index.html"><h2>Sparks Bank</h2></a>
              <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>
              <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ml-auto">
                  <li class="nav-item">
                    <a class="nav-link" href="index.php">Home</a>
                  </li>
                  
                  <li class="nav-item">
                    <a class="nav-link" href="customers.php">View Customers</a>
                  </li>
                  <li class="nav-item active">
                    <a class="nav-link" href="transfers.php">Transfers</a>
                  </li>
                </ul>
              </div>
            </div>
          </nav>

        </header>

        <div class="main-banner header-text" id="top">
            <div class="Modern-Slider">
              <!-- Item -->
              <div class="item item-1">
                <div class="img-fill">
                    <div class="text-content">
                      <h6>choose the accounts for transfers</h6>
                      <h4>Money Transfers</h4>

                    </div>
                </div>
              </div>
            </div>
        </div>

        <style media="screen">
        /* Call Back Style */

        .callback-services {
          border-top: 1px solid #eee;
          padding-top: 140px;
        }

        .contact-us {
          background-color: #f7f7f7;
          padding: 140px 0px;
        }

        .contact-us .contact-form {
          background-color: transparent!important;
          padding: 0!important;
        }

        .callback-form {
          margin-top: 140px;
        }

        .callback-form .contact-form {
          background-color: #a4c639;
          padding: 60px;
          border-radius: 5px;
          text-align: center;
        }

        .callback-form .contact-form input {
          border-radius: 20px;
          height: 40px;
          line-height: 40px;
          display: inline-block;
          padding: 0px 15px;
          color: #6a6a6a;
          font-size: 13px;
          text-transform: none;
          box-shadow: none;
          border: none;
          margin-bottom: 35px;
        }

        .callback-form .contact-form input:focus {
          outline: none;
          box-shadow: none;
          border: none;
        }

        .callback-form .contact-form textarea {
          border-radius: 20px;
          height: 120px;
          max-height: 200px;
          min-height: 120px;
          display: inline-block;
          padding: 15px;
          color: #6a6a6a;
          font-size: 13px;
          text-transform: none;
          box-shadow: none;
          border: none;
          margin-bottom: 35px;
        }

        .callback-form .contact-form textarea:focus {
          outline: none;
          box-shadow: none;
          border: none;
        }

        .callback-form .contact-form ::-webkit-input-placeholder { /* Edge */
          color: #aaa;
        }
        .callback-form .contact-form :-ms-input-placeholder { /* Internet Explorer 10-11 */
          color: #aaa;
        }
        .callback-form .contact-form ::placeholder {
          color: #aaa;
        }

        .callback-form .contact-form button.border-button {
          background-color: transparent;
          color: #fff;
          border: 2px solid #fff;
          font-size: 13px;
          text-transform: uppercase;
          font-weight: 700;
          padding: 10px 28px;
          border-radius: 30px;
          display: inline-block;
          transition: all 0.3s;
          outline: none;
          box-shadow: none;
          text-shadow: none;
          cursor: pointer;
        }

        .callback-form .contact-form button.border-button:hover {
          background-color: #fff;
          color: #a4c639;
        }

        .contact-us .contact-form button.filled-button {
          background-color: #a4c639;
          color: #fff;
          border: none;
          font-size: 13px;
          text-transform: uppercase;
          font-weight: 700;
          padding: 12px 30px;
          border-radius: 30px;
          display: inline-block;
          transition: all 0.3s;
          outline: none;
          box-shadow: none;
          text-shadow: none;
          cursor: pointer;
        }

        .contact-us .contact-form button.filled-button:hover {
          background-color: #fff;
          color: #a4c639;
        }
        </style>

        <div class="callback-form contact-us">
          <div class="container">
            <div class="row">
              <div class="col-md-12">
                <div class="section-heading">
                  <h2>Transfer <em>Money</em></h2>
                  <span>Choose the accounts</span>
                </div>
              </div>
              <div class="col-md-12">
                <div class="contact-form">
                  <form id="transfer" action="transfers.php" method="post">
                    <div class="row">
                      <div class="col-lg-4 col-md-12 col-sm-12">
                        <fieldset>
                          <input name="acc1" type="text" class="form-control" id="acc1" placeholder="Sender's Acc. Number" required="">
                        </fieldset>
                      </div>
                      <div class="col-lg-4 col-md-12 col-sm-12">
                        <fieldset>
                          <input name="acc2" type="text" class="form-control" id="acc2"  placeholder="Reciever's Acc. Number" required="">
                        </fieldset>
                      </div>
                      <div class="col-lg-4 col-md-12 col-sm-12">
                        <fieldset>
                          <input name="amount" type="text" class="form-control" id="amount" placeholder="Amount" required="">
                        </fieldset>
                      </div>
                      <div class="col-lg-12">
                        <fieldset>
                          <textarea name="message" rows="6" class="form-control" id="message" placeholder="Your Message" required=""></textarea>
                        </fieldset>
                      </div>
                      <div class="col-lg-12">
                        <fieldset>
                          <button type="submit" id="form-submit" class="filled-button">Transfer</button>
                        </fieldset>
                      </div>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
        <?php
              $servername = "localhost";
              $username = "root";
              $password = "";
              $database = "internship";

              $conn = mysqli_connect($servername, $username, $password, $database);
              if(!$conn){
                die("Connection not established: ".mysqli_connect_error());
              }else{

                if($_SERVER['REQUEST_METHOD']== 'POST'){


                  $sender = $_POST['acc1'];
                  $amount = $_POST['amount'];
                  $reciever = $_POST['acc2'];


                  $checkbalquery = "SELECT bal FROM users where accno='$sender'";
                  $checkbal = mysqli_query($conn, $checkbalquery);
                  $ava_bal = mysqli_fetch_assoc($checkbal)['bal'];

                  if($ava_bal >= $amount){
                    $sql1 = "UPDATE users SET bal= bal-$amount WHERE accno='$sender'";
                    $sql2 = "UPDATE users SET bal= bal+$amount WHERE accno='$reciever'";
                    $result1 = mysqli_query($conn, $sql1);
                    $result2 = mysqli_query($conn, $sql2);
                    if($result1 && $result2){
                    echo '<script>alert("Transfer Successful!") </script>';

                    $sqltran = "INSERT INTO `transactions` (`sender`, `receiver`, `amount`, `status`) VALUES ('$sender', '$reciever', '$amount', 'succeed')";
                    $sqltransact = mysqli_query($conn, $sqltran);
                  }else{
                    echo '<script>alert("Transfer Unsuccessful!") </script>';
                    $sqltran = "INSERT INTO `transactions` (`sender`, `receiver`, `amount`, `status`) VALUES ('$sender', '$reciever', '$amount', 'failed')";
                    $sqltransact = mysqli_query($conn, $sqltran);
                  }
                  }else{
                    echo '<script>alert("Insufficient Balance!") </script>
                    ';
                    $sqltran = "INSERT INTO `transactions` (`sender`, `receiver`, `amount`, `status`) VALUES ('$sender', '$reciever', '$amount', 'failed')";
                    $sqltransact = mysqli_query($conn, $sqltran);
                  }
                }
              }
        ?>
  </body>
</html>
